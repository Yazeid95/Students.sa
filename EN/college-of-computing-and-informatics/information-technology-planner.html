<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IT Study Plan Builder - Students.sa</title>
    <link rel="stylesheet" href="../../css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="logo-container">
        <img src="../../images/seu-students-logo-dark-green.png" alt="SEU Students Logo" class="header-logo dark-logo">
        <img src="../../images/seu-students-logo-gold.png" alt="SEU Students Logo" class="header-logo light-logo">
    </div>

    <div class="top-controls">
        <button class="control-btn" id="themeToggle" onclick="toggleTheme()" title="Toggle Dark/Light Mode">
            <svg class="theme-icon" viewBox="0 0 24 24" width="28" height="28">
                <path class="sun-icon" fill="currentColor" d="M12 17.5c-1.38 0-2.63-.56-3.54-1.46A4.98 4.98 0 0 1 7 12c0-1.38.56-2.63 1.46-3.54A4.98 4.98 0 0 1 12 6.5c1.38 0 2.63.56 3.54 1.46A4.98 4.98 0 0 1 17 12c0 1.38-.56 2.63-1.46 3.54A4.98 4.98 0 0 1 12 17.5zm5.5-9.5h2v2h-2V8zm0 8h2v2h-2v-2zM8 8H6v2h2V8zm0 8H6v2h2v-2zm8.5-5.5v-2h2v2h-2zm-13 0v-2h2v2h-2zM12 2v2a8 8 0 1 0 0 16v2c-5.52 0-10-4.48-10-10S6.48 2 12 2z"/>
                <path class="moon-icon" fill="currentColor" style="display: none;" d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9z"/>
            </svg>
        </button>
        
        <button class="control-btn" id="languageToggle" onclick="toggleLanguage()" title="Switch Language">
            <span class="lang-text" id="langText">ع</span>
        </button>
    </div>

    <div class="study-plan-container">
        <!-- Header Section -->
        <div class="plan-header">
            <h1 class="plan-title">Information Technology Study Plan</h1>
            <div class="progress-stats">
                <div class="stat-item">
                    <span class="stat-label">Completed Courses:</span>
                    <span class="stat-value" id="completedCount">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Completed Hours:</span>
                    <span class="stat-value" id="completedHours">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Remaining Courses:</span>
                    <span class="stat-value" id="remainingCount">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Remaining Hours:</span>
                    <span class="stat-value" id="remainingHours">0</span>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="plan-content">
            <!-- Left Side: Available Courses -->
            <div class="available-courses-section">
                <h2 class="section-title">Available Courses</h2>
                
                <div class="available-courses-list" id="availableCoursesList">
                    <!-- Dynamic content will be generated here -->
                </div>
            </div>

            <!-- Right Side: Term Builder -->
            <div class="term-builder-section">
                <h2 class="section-title">Custom Term Builder</h2>
                
                <!-- Term Summary -->
                <div class="term-summary">
                    <div class="summary-item">
                        <span class="summary-label">Selected Courses:</span>
                        <span class="summary-value" id="selectedCoursesCount">0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Total Hours:</span>
                        <span class="summary-value" id="totalHours">0</span>
                    </div>
                    <div class="summary-item">
                        <span class="summary-label">Max Hours:</span>
                        <span class="summary-value">18</span>
                    </div>
                </div>

                <!-- Selected Courses List -->
                <div class="selected-courses-container">
                    <div class="empty-state" id="emptyState">
                        <p>No courses selected yet</p>
                        <small>Click the + button next to available courses to add them</small>
                    </div>
                    <div class="selected-courses-list" id="selectedCoursesList">
                        <!-- Selected courses will be added here -->
                    </div>
                </div>

                <!-- Schedule Builder -->
                <div class="schedule-builder" id="scheduleBuilder" style="display: none;">
                    <h3>Course Schedule</h3>
                    <div class="schedule-options">
                        <label class="schedule-option">
                            <input type="radio" name="scheduleView" value="weekly" checked>
                            Weekly View
                        </label>
                        <label class="schedule-option">
                            <input type="radio" name="scheduleView" value="daily">
                            Daily View
                        </label>
                    </div>
                    
                    <div class="schedule-grid" id="scheduleGrid">
                        <!-- Schedule will be generated here -->
                    </div>
                    
                    <div class="export-buttons">
                        <button class="export-btn" onclick="exportSchedule('pdf')">
                            <svg viewBox="0 0 24 24" width="16" height="16">
                                <path fill="currentColor" d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                            </svg>
                            Export PDF
                        </button>
                        <button class="export-btn" onclick="exportSchedule('jpeg')">
                            <svg viewBox="0 0 24 24" width="16" height="16">
                                <path fill="currentColor" d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"/>
                            </svg>
                            Export JPEG
                        </button>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="term-actions">
                    <button class="action-btn secondary" onclick="clearTerm()">Clear All</button>
                    <button class="action-btn schedule" onclick="generateSchedule()" id="scheduleBtn" disabled>Create Schedule</button>
                    <button class="action-btn primary" onclick="saveTerm()" id="saveTermBtn" disabled>Save Term</button>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div class="navigation-buttons">
            <button class="nav-btn secondary" onclick="goBack()">
                <svg class="arrow-icon" viewBox="0 0 24 24" width="16" height="16">
                    <path fill="currentColor" d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                </svg>
                Back to Questionnaire
            </button>
        </div>

        <!-- Calendar Modal -->
        <div class="calendar-modal" id="calendarModal" style="display: none;">
            <div class="calendar-content">
                <div class="calendar-header">
                    <h2>Course Schedule Calendar</h2>
                    <button class="close-calendar" onclick="closeCalendar()">×</button>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- Calendar will be generated here -->
                </div>
                <div class="calendar-actions">
                    <button class="export-calendar-btn" onclick="exportCalendar()">
                        <svg viewBox="0 0 24 24" width="16" height="16">
                            <path fill="currentColor" d="M8.5,13.5L11,16.5L14.5,12L19,18H5M21,19V5C21,3.89 20.1,3 19,3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19Z"/>
                        </svg>
                        Export as JPEG
                    </button>
                    <button class="close-calendar-btn" onclick="closeCalendar()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // All course data with prerequisites
        const allCourses = {
            university: [
                { code: "ENG001", name: "English Skills 1", hours: 8, prerequisites: [], category: "university" },
                { code: "ENG002", name: "English Skills 2", hours: 8, prerequisites: [], category: "university" },
                { code: "CS001", name: "Computer Essentials", hours: 3, prerequisites: [], category: "university" },
                { code: "MATH001", name: "Fundamentals of Mathematics", hours: 3, prerequisites: [], category: "university" },
                { code: "COMM001", name: "Communication Skills", hours: 2, prerequisites: [], category: "university" },
                { code: "CI001", name: "Academic Skills", hours: 2, prerequisites: [], category: "university" }
            ],
            shared: [
                { code: "ISLM101", name: "Islamic Course 1", hours: 2, prerequisites: [], category: "university" },
                { code: "ISLM102", name: "Islamic Course 2", hours: 2, prerequisites: [], category: "university" },
                { code: "ISLM103", name: "Islamic Course 3", hours: 2, prerequisites: [], category: "university" },
                { code: "ISLM104", name: "Islamic Course 4", hours: 2, prerequisites: [], category: "university" },
                { code: "SCI101", name: "General Physics 1", hours: 3, prerequisites: [], category: "college" },
                { code: "SCI201", name: "General Physics 2", hours: 3, prerequisites: ["SCI101"], category: "college" },
                { code: "MATH150", name: "Discrete Mathematics", hours: 3, prerequisites: [], category: "college" },
                { code: "MATH251", name: "Linear Algebra", hours: 3, prerequisites: ["MATH150"], category: "college" },
                { code: "ENG103", name: "Technical Writing", hours: 3, prerequisites: [], category: "college" },
                { code: "STAT101", name: "Statistics", hours: 3, prerequisites: [], category: "college" }
            ],
            major: [
                { code: "IT231", name: "Introduction to IT and IS", hours: 3, prerequisites: [], category: "major" },
                { code: "IT232", name: "Object Oriented Programming", hours: 3, prerequisites: [], category: "major" },
                { code: "IT233", name: "Computer Organization", hours: 3, prerequisites: [], category: "major" },
                { code: "IT241", name: "Operating Systems", hours: 3, prerequisites: ["IT233"], category: "major" },
                { code: "IT244", name: "Introduction to Database", hours: 3, prerequisites: ["IT232"], category: "major" },
                { code: "IT245", name: "Data Structure", hours: 3, prerequisites: ["IT232"], category: "major" },
                { code: "IT351", name: "Computer Networks", hours: 3, prerequisites: ["IT241"], category: "major" },
                { code: "IT352", name: "Human Computer Interaction", hours: 3, prerequisites: ["IT231", "IT245"], category: "major" },
                { code: "IT353", name: "System Analysis and Design", hours: 3, prerequisites: ["IT245"], category: "major" },
                { code: "IT354", name: "Database Management Systems", hours: 3, prerequisites: ["IT244"], category: "major" },
                { code: "IT361", name: "Web Technologies", hours: 3, prerequisites: ["IT352", "IT244"], category: "major" },
                { code: "IT362", name: "IT Project Management", hours: 3, prerequisites: ["IT353"], category: "major" },
                { code: "IT363", name: "Network Management", hours: 3, prerequisites: ["IT351"], category: "major" },
                { code: "IT364", name: "IT Entrepreneurship and Innovation", hours: 3, prerequisites: ["IT244"], category: "major" },
                { code: "IT365", name: "Enterprise Systems", hours: 3, prerequisites: ["IT352"], category: "major" },
                { code: "IT474", name: "Introduction to Cyber Security and Digital Crime", hours: 3, prerequisites: ["IT363"], category: "major" },
                { code: "IT475", name: "Decision Support Systems", hours: 3, prerequisites: ["IT354"], category: "major" },
                { code: "IT476", name: "IT Security & Policies", hours: 3, prerequisites: ["IT351"], category: "major" },
                { code: "IT478", name: "Network Security", hours: 3, prerequisites: ["IT363"], category: "major" },
                { code: "IT479", name: "Senior Project I", hours: 3, prerequisites: ["IT354", "IT361"], category: "major" },
                { code: "IT484", name: "Wireless Sensor Networks", hours: 3, prerequisites: ["IT474"], category: "major" },
                { code: "IT485", name: "Professional Ethics in IT", hours: 3, prerequisites: ["IT362"], category: "major" },
                { code: "IT487", name: "Advanced Topics in IT", hours: 3, prerequisites: ["IT475"], category: "major" },
                { code: "IT488", name: "Cyber Forensics", hours: 3, prerequisites: ["IT474"], category: "major" },
                { code: "IT489", name: "Senior Project II", hours: 3, prerequisites: ["IT479"], category: "major" },
                { code: "IT499", name: "Practical Training", hours: 3, prerequisites: [], category: "major" }
            ]
        };

        // State management
        let completedCourses = new Set();
        let selectedTermCourses = new Set();
        let courseSchedule = new Map(); // Store course schedule info

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadUserProgress();
            updateStats();
            renderAvailableCourses();
            initializeTheme();
            
            // Add event listeners for schedule view options
            document.querySelectorAll('input[name="scheduleView"]').forEach(radio => {
                radio.addEventListener('change', renderScheduleGrid);
            });
        });

        function loadUserProgress() {
            // Get user's completed courses from URL parameters or localStorage
            const urlParams = new URLSearchParams(window.location.search);
            const firstYear = urlParams.get('firstYear') === 'true';
            const shared = urlParams.get('shared') ? urlParams.get('shared').split(',') : [];
            const semesters = parseInt(urlParams.get('semesters')) || 0;

            // Add completed courses based on user's progress
            if (firstYear) {
                allCourses.university.forEach(course => completedCourses.add(course.code));
            }

            shared.forEach(courseCode => completedCourses.add(courseCode));

            // Add courses based on completed semesters
            const semesterCourses = {
                3: ["IT231", "IT232", "IT233"],
                4: ["IT241", "IT244", "IT245"],
                5: ["IT351", "IT352", "IT353", "IT354"],
                6: ["IT361", "IT362", "IT363", "IT364", "IT365"],
                7: ["IT474", "IT475", "IT476", "IT478", "IT479"],
                8: ["IT484", "IT485", "IT487", "IT488", "IT489", "IT499"]
            };

            for (let sem = 3; sem <= semesters; sem++) {
                if (semesterCourses[sem]) {
                    semesterCourses[sem].forEach(courseCode => completedCourses.add(courseCode));
                }
            }
        }

        function getAllCourses() {
            return [...allCourses.university, ...allCourses.shared, ...allCourses.major];
        }

        function isPrerequisitesMet(course) {
            return course.prerequisites.every(prereq => completedCourses.has(prereq));
        }

        function getAvailableCourses() {
            const allCoursesFlat = getAllCourses();
            return allCoursesFlat.filter(course => 
                !completedCourses.has(course.code) && 
                !selectedTermCourses.has(course.code) &&
                isPrerequisitesMet(course)
            );
        }

        function renderAvailableCourses() {
            const container = document.getElementById('availableCoursesList');
            let availableCourses = getAvailableCourses();

            if (availableCourses.length === 0) {
                container.innerHTML = `
                    <div class="empty-courses">
                        <p>No available courses</p>
                        <small>Complete prerequisite courses to unlock more options</small>
                    </div>
                `;
                return;
            }

            container.innerHTML = availableCourses.map(course => `
                <div class="course-card" data-course="${course.code}">
                    <div class="course-info">
                        <div class="course-header">
                            <span class="course-code">${course.code}</span>
                            <span class="course-hours">${course.hours} hrs</span>
                            <span class="course-category">${course.category}</span>
                        </div>
                        <div class="course-name">${course.name}</div>
                        ${course.prerequisites.length > 0 ? 
                            `<div class="prerequisites">
                                <small>Prerequisites: ${course.prerequisites.join(', ')}</small>
                            </div>` : ''
                        }
                    </div>
                    <div class="course-actions">
                        <button class="add-course-btn" onclick="addCourseToTerm('${course.code}')">
                            <span class="add-icon">+</span>
                        </button>
                        <button class="done-course-btn" onclick="markCourseCompleted('${course.code}')" 
                                title="Mark as completed">
                            <span class="done-icon">✓</span>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function addCourseToTerm(courseCode) {
            const course = getAllCourses().find(c => c.code === courseCode);
            if (!course) return;

            // Check if total hours would exceed limit
            const currentHours = Array.from(selectedTermCourses).reduce((total, code) => {
                const c = getAllCourses().find(course => course.code === code);
                return total + (c ? c.hours : 0);
            }, 0);

            if (currentHours + course.hours > 18) {
                alert(`Cannot add ${course.code}. Total hours would exceed 18 hour limit (current: ${currentHours}, would be: ${currentHours + course.hours})`);
                return;
            }

            selectedTermCourses.add(courseCode);
            renderAvailableCourses();
            renderSelectedCourses();
            updateTermSummary();
        }

        function markCourseCompleted(courseCode) {
            const course = getAllCourses().find(c => c.code === courseCode);
            if (!course) return;

            // Confirm the action
            if (confirm(`Mark "${course.code} - ${course.name}" as completed?\n\nThis will unlock courses that require this as a prerequisite.`)) {
                // Add to completed courses
                completedCourses.add(courseCode);
                
                // Remove from selected term if it was there
                selectedTermCourses.delete(courseCode);
                courseSchedule.delete(courseCode);
                
                // Update displays
                renderAvailableCourses();
                renderSelectedCourses();
                updateTermSummary();
                updateStats();
                
                // Show notification
                showNotification(`${course.code} marked as completed! New courses may now be available.`);
            }
        }

        function showNotification(message) {
            // Create and show a temporary notification
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: rgba(212, 175, 55, 0.9);
                color: #051f12;
                padding: 16px 24px;
                border-radius: 8px;
                font-weight: 600;
                z-index: 1000;
                max-width: 300px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function removeCourseFromTerm(courseCode) {
            selectedTermCourses.delete(courseCode);
            courseSchedule.delete(courseCode);
            renderAvailableCourses();
            renderSelectedCourses();
            updateTermSummary();
        }

        function renderSelectedCourses() {
            const container = document.getElementById('selectedCoursesList');
            const emptyState = document.getElementById('emptyState');
            
            if (selectedTermCourses.size === 0) {
                emptyState.style.display = 'block';
                container.innerHTML = '';
                return;
            }
            
            emptyState.style.display = 'none';
            
            const selectedCoursesList = Array.from(selectedTermCourses).map(courseCode => {
                const course = getAllCourses().find(c => c.code === courseCode);
                return course;
            }).filter(Boolean);

            container.innerHTML = selectedCoursesList.map(course => `
                <div class="selected-course-item">
                    <div class="selected-course-info">
                        <span class="selected-course-code">${course.code}</span>
                        <span class="selected-course-name">${course.name}</span>
                        <span class="selected-course-hours">${course.hours} hrs</span>
                    </div>
                    <div class="course-time-selector">
                        <select class="day-select" onchange="updateCourseDays('${course.code}', this.value)">
                            <option value="">Select Days</option>
                            ${getAvailableDayOptions(course.code)}
                        </select>
                        <select class="time-select" onchange="updateCourseTime('${course.code}', this.value)">
                            <option value="">Select Time</option>
                            ${getAvailableTimeOptions(course.code)}
                        </select>
                        <input type="text" class="crn-input" placeholder="CRN Number" 
                               onchange="updateCourseCRN('${course.code}', this.value)"
                               value="${getCRNValue(course.code)}">
                    </div>
                    <button class="remove-course-btn" onclick="removeCourseFromTerm('${course.code}')">
                        <span class="remove-icon">×</span>
                    </button>
                </div>
            `).join('');
        }

        function getAvailableTimeOptions(currentCourseCode) {
            const timeSlots = [
                '3:00-3:50', '4:00-4:50', '5:00-5:50', 
                '6:00-6:50', '7:00-7:50', '8:00-8:50', '9:00-9:50'
            ];
            
            const currentCourseSchedule = courseSchedule.get(currentCourseCode);
            const currentTime = currentCourseSchedule?.time;
            const currentDays = currentCourseSchedule?.days;
            
            return timeSlots.map(timeSlot => {
                // Check if this time slot conflicts with another course that has the SAME days
                const isConflict = currentDays && Array.from(selectedTermCourses).some(courseCode => {
                    if (courseCode === currentCourseCode) return false; // Skip current course
                    
                    const schedule = courseSchedule.get(courseCode);
                    if (!schedule || !schedule.time || !schedule.days) return false;
                    
                    // Conflict only if BOTH same time AND same days
                    return schedule.time === timeSlot && schedule.days === currentDays;
                });
                
                const isSelected = currentTime === timeSlot;
                const isDisabled = isConflict && !isSelected;
                
                return `<option value="${timeSlot}" ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled style="color: #666;"' : ''}>
                    ${timeSlot}${isDisabled ? ' (Occupied)' : ''}
                </option>`;
            }).join('');
        }

        function getAvailableDayOptions(currentCourseCode) {
            const dayOptions = [
                { value: 'ST', label: 'Sunday & Tuesday' },
                { value: 'MW', label: 'Monday & Wednesday' }
            ];
            
            const currentCourseSchedule = courseSchedule.get(currentCourseCode);
            const currentDays = currentCourseSchedule?.days;
            
            // Days are always available - no conflicts for day selection alone
            return dayOptions.map(dayOption => {
                const isSelected = currentDays === dayOption.value;
                
                return `<option value="${dayOption.value}" ${isSelected ? 'selected' : ''}>
                    ${dayOption.label}
                </option>`;
            }).join('');
        }

        function updateTermSummary() {
            const coursesCount = selectedTermCourses.size;
            const totalHours = Array.from(selectedTermCourses).reduce((total, courseCode) => {
                const course = getAllCourses().find(c => c.code === courseCode);
                return total + (course ? course.hours : 0);
            }, 0);

            document.getElementById('selectedCoursesCount').textContent = coursesCount;
            document.getElementById('totalHours').textContent = totalHours;
            
            // Enable/disable buttons
            const saveBtn = document.getElementById('saveTermBtn');
            const scheduleBtn = document.getElementById('scheduleBtn');
            saveBtn.disabled = coursesCount === 0;
            scheduleBtn.disabled = coursesCount === 0;
            
            // Update hours color based on limit
            const hoursElement = document.getElementById('totalHours');
            if (totalHours > 18) {
                hoursElement.style.color = '#ef4444';
            } else if (totalHours > 15) {
                hoursElement.style.color = '#f59e0b';
            } else {
                hoursElement.style.color = '#d4af37';
            }
        }

        function generateCalendar() {
            const calendarModal = document.getElementById('calendarModal');
            calendarModal.style.display = 'flex';
            renderCalendarGrid();
        }

        function closeCalendar() {
            const calendarModal = document.getElementById('calendarModal');
            calendarModal.style.display = 'none';
        }

        function renderCalendarGrid() {
            const calendarGrid = document.getElementById('calendarGrid');
            const timeSlots = [
                '3:00-3:50', '4:00-4:50', '5:00-5:50', 
                '6:00-6:50', '7:00-7:50', '8:00-8:50', '9:00-9:50'
            ];
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday'];
            
            let html = `
                <div class="calendar-table">
                    <div class="calendar-table-header">
                        <div class="time-column-header">Time</div>
                        ${days.map(day => `<div class="day-column-header">${day}</div>`).join('')}
                    </div>
                    <div class="calendar-body">
            `;
            
            timeSlots.forEach(timeSlot => {
                html += `<div class="calendar-time-row">
                    <div class="calendar-time-cell">${timeSlot}</div>`;
                
                days.forEach(day => {
                    const course = findCourseForTimeAndDay(timeSlot, day);
                    html += `<div class="calendar-day-cell ${course ? 'has-course' : 'empty-cell'}">`;
                    
                    if (course) {
                        const schedule = courseSchedule.get(course.code);
                        html += `
                            <div class="calendar-course-block">
                                <div class="calendar-course-code">${course.code}</div>
                                <div class="calendar-course-name">${course.name}</div>
                                <div class="calendar-course-hours">${course.hours} hrs</div>
                                ${schedule?.crn ? `<div class="calendar-course-crn">CRN: ${schedule.crn}</div>` : ''}
                            </div>
                        `;
                    }
                    
                    html += `</div>`;
                });
                
                html += '</div>';
            });
            
            html += `
                    </div>
                </div>
                <div class="calendar-summary">
                    <h3>Term Summary</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <span class="summary-label">Total Courses:</span>
                            <span class="summary-value">${selectedTermCourses.size}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Total Hours:</span>
                            <span class="summary-value">${Array.from(selectedTermCourses).reduce((total, code) => {
                                const course = getAllCourses().find(c => c.code === code);
                                return total + (course ? course.hours : 0);
                            }, 0)}</span>
                        </div>
                    </div>
                    <div class="course-list-summary">
                        ${Array.from(selectedTermCourses).map(courseCode => {
                            const course = getAllCourses().find(c => c.code === courseCode);
                            const schedule = courseSchedule.get(courseCode);
                            return `
                                <div class="course-summary-item">
                                    <span class="course-code">${course.code}</span>
                                    <span class="course-name">${course.name}</span>
                                    <span class="course-schedule">${schedule?.days || 'No days'} | ${schedule?.time || 'No time'}</span>
                                    ${schedule?.crn ? `<span class="course-crn">CRN: ${schedule.crn}</span>` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
            
            calendarGrid.innerHTML = html;
        }

        async function exportCalendar() {
            const calendarElement = document.getElementById('calendarGrid');
            
            try {
                const canvas = await html2canvas(calendarElement, {
                    scale: 2,
                    backgroundColor: '#051f12',
                    width: calendarElement.scrollWidth,
                    height: calendarElement.scrollHeight,
                    useCORS: true
                });
                
                // Convert to JPEG and download
                const link = document.createElement('a');
                link.download = 'IT-Course-Calendar.jpeg';
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.click();
                
            } catch (error) {
                console.error('Error exporting calendar:', error);
                alert('Error exporting calendar. Please try again.');
            }
        }

        function updateCourseDays(courseCode, days) {
            if (!courseSchedule.has(courseCode)) {
                courseSchedule.set(courseCode, {});
            }
            courseSchedule.get(courseCode).days = days;
            
            // Refresh the selected courses display to update time availability
            renderSelectedCourses();
        }

        function updateCourseTime(courseCode, time) {
            if (!courseSchedule.has(courseCode)) {
                courseSchedule.set(courseCode, {});
            }
            courseSchedule.get(courseCode).time = time;
            
            // Refresh the selected courses display to update availability
            renderSelectedCourses();
        }

        function updateCourseCRN(courseCode, crn) {
            if (!courseSchedule.has(courseCode)) {
                courseSchedule.set(courseCode, {});
            }
            courseSchedule.get(courseCode).crn = crn;
        }

        function getCRNValue(courseCode) {
            const schedule = courseSchedule.get(courseCode);
            return schedule?.crn || '';
        }

        function generateSchedule() {
            const scheduleBuilder = document.getElementById('scheduleBuilder');
            scheduleBuilder.style.display = 'block';
            scheduleBuilder.scrollIntoView({ behavior: 'smooth' });
            
            renderScheduleGrid();
        }

        function renderScheduleGrid() {
            const scheduleGrid = document.getElementById('scheduleGrid');
            const viewType = document.querySelector('input[name="scheduleView"]:checked').value;
            
            if (viewType === 'weekly') {
                renderWeeklySchedule(scheduleGrid);
            } else {
                renderDailySchedule(scheduleGrid);
            }
        }

        function renderWeeklySchedule(container) {
            const timeSlots = [
                '3:00-3:50', '4:00-4:50', '5:00-5:50', 
                '6:00-6:50', '7:00-7:50', '8:00-8:50', '9:00-9:50'
            ];
            
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday'];
            
            let html = `
                <div class="schedule-table">
                    <div class="schedule-header">
                        <div class="time-header">Time</div>
                        ${days.map(day => `<div class="day-header">${day}</div>`).join('')}
                    </div>
            `;
            
            timeSlots.forEach(timeSlot => {
                html += `<div class="time-row">
                    <div class="time-cell">${timeSlot}</div>`;
                
                days.forEach(day => {
                    const course = findCourseForTimeAndDay(timeSlot, day);
                    html += `<div class="schedule-cell ${course ? 'occupied' : 'empty'}">
                        ${course ? `<div class="course-block">
                            <div class="course-code">${course.code}</div>
                            <div class="course-name">${course.name}</div>
                            ${courseSchedule.get(course.code)?.crn ? `<div class="course-crn">CRN: ${courseSchedule.get(course.code).crn}</div>` : ''}
                        </div>` : ''}
                    </div>`;
                });
                
                html += '</div>';
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        function renderDailySchedule(container) {
            const selectedCourses = Array.from(selectedTermCourses).map(code => {
                const course = getAllCourses().find(c => c.code === code);
                const schedule = courseSchedule.get(code) || {};
                return { ...course, schedule };
            });

            let html = `
                <div class="daily-schedule">
                    ${selectedCourses.map(course => `
                        <div class="daily-course-item">
                            <div class="course-info">
                                <span class="course-code">${course.code}</span>
                                <span class="course-name">${course.name}</span>
                            </div>
                            <div class="schedule-info">
                                <span class="course-time">${course.schedule.time || 'No time set'}</span>
                                <span class="course-days">${course.schedule.days || 'No days set'}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
            
            container.innerHTML = html;
        }

        function findCourseForTimeAndDay(timeSlot, day) {
            for (const courseCode of selectedTermCourses) {
                const schedule = courseSchedule.get(courseCode);
                if (!schedule || !schedule.time || !schedule.days) continue;
                
                if (schedule.time === timeSlot) {
                    const dayMappings = {
                        'ST': ['Sunday', 'Tuesday'],
                        'MW': ['Monday', 'Wednesday']
                    };
                    
                    const courseDays = dayMappings[schedule.days] || [];
                    if (courseDays.includes(day)) {
                        return getAllCourses().find(c => c.code === courseCode);
                    }
                }
            }
            return null;
        }

        async function exportSchedule(format) {
            const scheduleElement = document.getElementById('scheduleGrid');
            
            if (format === 'pdf') {
                await exportToPDF(scheduleElement);
            } else if (format === 'jpeg') {
                await exportToJPEG(scheduleElement);
            }
        }

        async function exportToPDF(element) {
            try {
                // Use html2canvas to capture the schedule
                const canvas = await html2canvas(element, {
                    scale: 2,
                    backgroundColor: '#051f12',
                    onclone: function(clonedDoc) {
                        // Ensure fonts are loaded in cloned document
                        const clonedElement = clonedDoc.getElementById('scheduleGrid');
                        if (clonedElement) {
                            clonedElement.style.fontFamily = 'Inter, sans-serif';
                        }
                    }
                });
                
                // Create PDF using jsPDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'landscape',
                    unit: 'mm',
                    format: 'a4'
                });
                
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 297; // A4 landscape width in mm
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                pdf.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
                pdf.save('IT-Course-Schedule.pdf');
                
            } catch (error) {
                console.error('Error exporting PDF:', error);
                alert('Error exporting PDF. Please try again.');
            }
        }

        async function exportToJPEG(element) {
            try {
                const canvas = await html2canvas(element, {
                    scale: 2,
                    backgroundColor: '#051f12'
                });
                
                // Convert to JPEG and download
                const link = document.createElement('a');
                link.download = 'IT-Course-Schedule.jpeg';
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.click();
                
            } catch (error) {
                console.error('Error exporting JPEG:', error);
                alert('Error exporting JPEG. Please try again.');
            }
        }

        function updateStats() {
            const allCoursesFlat = getAllCourses();
            const completedCount = completedCourses.size;
            const totalCount = allCoursesFlat.length;
            const remainingCount = totalCount - completedCount;
            
            // Calculate completed hours
            const completedHours = Array.from(completedCourses).reduce((total, courseCode) => {
                const course = allCoursesFlat.find(c => c.code === courseCode);
                return total + (course ? course.hours : 0);
            }, 0);
            
            // Calculate total hours and remaining hours
            const totalHours = allCoursesFlat.reduce((total, course) => total + course.hours, 0);
            const remainingHours = totalHours - completedHours;

            document.getElementById('completedCount').textContent = completedCount;
            document.getElementById('completedHours').textContent = completedHours;
            document.getElementById('remainingCount').textContent = remainingCount;
            document.getElementById('remainingHours').textContent = remainingHours;
        }

        function clearTerm() {
            selectedTermCourses.clear();
            courseSchedule.clear();
            document.getElementById('scheduleBuilder').style.display = 'none';
            renderAvailableCourses();
            renderSelectedCourses();
            updateTermSummary();
        }

        function saveTerm() {
            if (selectedTermCourses.size === 0) return;
            
            const selectedCourses = Array.from(selectedTermCourses);
            const totalHours = Array.from(selectedTermCourses).reduce((total, courseCode) => {
                const course = getAllCourses().find(c => c.code === courseCode);
                return total + (course ? course.hours : 0);
            }, 0);
            
            // Save to localStorage
            const savedTerms = JSON.parse(localStorage.getItem('savedTerms') || '[]');
            savedTerms.push({
                id: Date.now(),
                courses: selectedCourses,
                totalHours: totalHours,
                createdAt: new Date().toISOString()
            });
            localStorage.setItem('savedTerms', JSON.stringify(savedTerms));
            
            alert(`Term saved successfully!\nCourses: ${selectedCourses.length}\nTotal Hours: ${totalHours}`);
            
            // Optionally clear the term after saving
            // clearTerm();
        }

        function goBack() {
            window.location.href = 'information-technology.html';
        }

        // Theme and language functions
        function toggleTheme() {
            document.body.classList.toggle('light-mode');
            const isLight = document.body.classList.contains('light-mode');
            
            const sunIcon = document.querySelector('.sun-icon');
            const moonIcon = document.querySelector('.moon-icon');
            
            if (isLight) {
                sunIcon.style.display = 'none';
                moonIcon.style.display = 'block';
                localStorage.setItem('theme', 'light');
            } else {
                sunIcon.style.display = 'block';
                moonIcon.style.display = 'none';
                localStorage.setItem('theme', 'dark');
            }
        }

        function toggleLanguage() {
            window.location.href = '../../AR/ar-college-of-computing-and-informatics/information-technology-planner.html';
        }

        function initializeTheme() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'light') {
                document.body.classList.add('light-mode');
                const sunIcon = document.querySelector('.sun-icon');
                const moonIcon = document.querySelector('.moon-icon');
                if (sunIcon) sunIcon.style.display = 'none';
                if (moonIcon) moonIcon.style.display = 'block';
            }
        }
    </script>

    <style>
        .study-plan-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .plan-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(13, 40, 24, 0.3);
            border-radius: 12px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .plan-title {
            font-size: 32px;
            font-weight: 700;
            color: #d4af37;
            margin-bottom: 20px;
        }

        .progress-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            display: block;
            font-size: 14px;
            color: #e8f5f0;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #d4af37;
        }

        .plan-content {
            display: grid;
            grid-template-columns: 1fr 500px;
            gap: 30px;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 600;
            color: #d4af37;
            margin-bottom: 20px;
        }

        /* Available Courses Section */
        .available-courses-section {
            background: rgba(13, 40, 24, 0.3);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid rgba(212, 175, 55, 0.2);
            height: fit-content;
        }

        .available-courses-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .course-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            margin-bottom: 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border: 1px solid rgba(212, 175, 55, 0.1);
            transition: all 0.3s ease;
        }

        .course-card:hover {
            border-color: rgba(212, 175, 55, 0.3);
            background: rgba(212, 175, 55, 0.05);
        }

        .course-info {
            flex: 1;
        }

        .course-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .course-code {
            font-weight: 600;
            color: #d4af37;
            font-size: 16px;
        }

        .course-hours {
            font-size: 12px;
            color: #a0a6a4;
            background: rgba(212, 175, 55, 0.1);
            padding: 2px 8px;
            border-radius: 4px;
        }

        .course-category {
            font-size: 11px;
            color: #e8f5f0;
            background: rgba(13, 40, 24, 0.3);
            padding: 2px 6px;
            border-radius: 3px;
            text-transform: capitalize;
        }

        .course-name {
            font-size: 14px;
            color: #e8f5f0;
            margin-bottom: 4px;
        }

        .prerequisites {
            font-size: 12px;
            color: #a0a6a4;
        }

        .course-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .add-course-btn, .done-course-btn {
            width: 36px;
            height: 36px;
            border: 2px solid;
            background: transparent;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: bold;
        }

        .add-course-btn {
            border-color: #d4af37;
            color: #d4af37;
        }

        .add-course-btn:hover:not(:disabled) {
            background: #d4af37;
            color: #051f12;
        }

        .add-course-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .done-course-btn {
            border-color: #22c55e;
            color: #22c55e;
        }

        .done-course-btn:hover {
            background: #22c55e;
            color: #051f12;
        }

        /* Term Builder Section */
        .term-builder-section {
            background: rgba(13, 40, 24, 0.3);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid rgba(212, 175, 55, 0.2);
            height: fit-content;
            position: sticky;
            top: 20px;
        }

        .term-summary {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 20px;
            padding: 16px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .summary-label {
            font-size: 14px;
            color: #e8f5f0;
        }

        .summary-value {
            font-weight: 600;
            color: #d4af37;
        }

        .selected-courses-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 20px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #a0a6a4;
        }

        .empty-state p {
            margin-bottom: 8px;
            font-size: 16px;
        }

        .empty-state small {
            font-size: 12px;
        }

        .selected-courses-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .selected-course-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 6px;
            border: 1px solid rgba(212, 175, 55, 0.2);
            flex-wrap: wrap;
            gap: 8px;
        }

        .selected-course-info {
            flex: 1;
            min-width: 150px;
        }

        .selected-course-code {
            display: block;
            font-weight: 600;
            color: #d4af37;
            font-size: 14px;
        }

        .selected-course-name {
            display: block;
            font-size: 12px;
            color: #e8f5f0;
            margin: 2px 0;
        }

        .selected-course-hours {
            font-size: 11px;
            color: #a0a6a4;
        }

        .course-time-selector {
            display: flex;
            flex-direction: column;
            gap: 4px;
            min-width: 120px;
        }

        .time-select, .day-select, .crn-input {
            padding: 4px 8px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            background: rgba(0, 0, 0, 0.2);
            color: #e8f5f0;
            border-radius: 4px;
            font-size: 11px;
        }

        .crn-input {
            font-family: inherit;
        }

        .crn-input::placeholder {
            color: #a0a6a4;
            font-style: italic;
        }

        .time-select option, .day-select option {
            background: #051f12;
            color: #e8f5f0;
        }

        .time-select option:disabled, .day-select option:disabled {
            background: #333;
            color: #666;
            font-style: italic;
        }

        .remove-course-btn {
            width: 24px;
            height: 24px;
            border: 1px solid #ef4444;
            background: transparent;
            color: #ef4444;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 16px;
            flex-shrink: 0;
        }

        .remove-course-btn:hover {
            background: #ef4444;
            color: white;
        }

        /* Schedule Builder Styles */
        .schedule-builder {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .schedule-builder h3 {
            color: #d4af37;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .schedule-options {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding: 12px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 8px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .schedule-option {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #e8f5f0;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .schedule-option:hover {
            background: rgba(212, 175, 55, 0.2);
        }

        .schedule-option input[type="radio"] {
            accent-color: #d4af37;
            width: 16px;
            height: 16px;
        }

        .schedule-table {
            display: grid;
            grid-template-columns: 60px repeat(4, minmax(0, 1fr));
            gap: 1px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 20px;
            width: 100%;
        }

        .schedule-header {
            display: contents;
        }

        .time-header, .day-header {
            background: rgba(212, 175, 55, 0.2);
            padding: 12px 8px;
            font-weight: 600;
            color: #d4af37;
            text-align: center;
            font-size: 12px;
            border-radius: 6px;
            margin: 2px;
        }

        .time-row {
            display: contents;
        }

        .time-cell {
            background: rgba(212, 175, 55, 0.1);
            padding: 4px 2px;
            font-size: 8px;
            color: #e8f5f0;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            border-radius: 6px;
            margin: 2px;
            line-height: 1;
            font-weight: 600;
        }

        .schedule-cell {
            background: rgba(0, 0, 0, 0.2);
            padding: 4px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            margin: 2px;
        }

        .schedule-cell.occupied {
            background: rgba(212, 175, 55, 0.2);
            border-radius: 10px;
            margin: 2px;
        }

        .course-block {
            text-align: center;
            width: 100%;
        }

        .course-block .course-code {
            font-weight: 600;
            color: #d4af37;
            font-size: 10px;
            display: block;
        }

        .course-block .course-name {
            font-size: 8px;
            color: #e8f5f0;
            line-height: 1.2;
            margin-top: 2px;
        }

        .course-block .course-crn {
            font-size: 7px;
            color: #d4af37;
            line-height: 1.1;
            margin-top: 1px;
            font-weight: 600;
        }

        .daily-schedule {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .daily-course-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 6px;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        .daily-course-item .course-info {
            flex: 1;
        }

        .daily-course-item .course-code {
            font-weight: 600;
            color: #d4af37;
            font-size: 14px;
        }

        .daily-course-item .course-name {
            color: #e8f5f0;
            font-size: 12px;
        }

        .schedule-info {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }

        .course-time, .course-days {
            font-size: 12px;
            color: #a0a6a4;
        }

        .export-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .export-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: transparent;
            border: 1px solid #d4af37;
            color: #d4af37;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .export-btn:hover {
            background: rgba(212, 175, 55, 0.1);
        }

        .export-btn svg {
            fill: currentColor;
        }

        .term-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .action-btn {
            flex: 1;
            min-width: 100px;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn.secondary {
            background: transparent;
            border: 1px solid #a0a6a4;
            color: #a0a6a4;
        }

        .action-btn.secondary:hover {
            background: rgba(160, 166, 164, 0.1);
        }

        .action-btn.schedule {
            background: transparent;
            border: 1px solid #d4af37;
            color: #d4af37;
        }

        .action-btn.schedule:hover:not(:disabled) {
            background: rgba(212, 175, 55, 0.1);
        }

        .action-btn.calendar {
            background: transparent;
            border: 1px solid #22c55e;
            color: #22c55e;
        }

        .action-btn.calendar:hover:not(:disabled) {
            background: rgba(34, 197, 94, 0.1);
        }

        .action-btn.primary {
            background: linear-gradient(135deg, #d4af37 0%, #b8941f 100%);
            color: #051f12;
        }

        .action-btn.primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(212, 175, 55, 0.3);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Calendar Modal Styles */
        .calendar-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .calendar-content {
            background: #051f12;
            border-radius: 12px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            max-width: 95vw;
            max-height: 95vh;
            overflow-y: auto;
            position: relative;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }

        .calendar-header h2 {
            color: #d4af37;
            margin: 0;
            font-size: 24px;
        }

        .close-calendar {
            background: none;
            border: none;
            color: #e8f5f0;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        .close-calendar:hover {
            background: rgba(212, 175, 55, 0.2);
        }

        .calendar-table {
            margin: 20px;
        }

        .calendar-table-header {
            display: grid;
            grid-template-columns: 100px repeat(4, 1fr);
            gap: 2px;
            margin-bottom: 2px;
        }

        .time-column-header, .day-column-header {
            background: rgba(212, 175, 55, 0.3);
            padding: 12px 8px;
            font-weight: 600;
            color: #d4af37;
            text-align: center;
            font-size: 14px;
            border-radius: 4px;
        }

        .calendar-time-row {
            display: grid;
            grid-template-columns: 100px repeat(4, 1fr);
            gap: 2px;
            margin-bottom: 2px;
        }

        .calendar-time-cell {
            background: rgba(212, 175, 55, 0.1);
            padding: 12px 6px;
            font-size: 12px;
            color: #e8f5f0;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            border-radius: 4px;
        }

        .calendar-day-cell {
            background: rgba(0, 0, 0, 0.2);
            padding: 8px;
            min-height: 80px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .calendar-day-cell.has-course {
            background: rgba(212, 175, 55, 0.2);
        }

        .calendar-course-block {
            text-align: center;
            width: 100%;
        }

        .calendar-course-code {
            font-weight: 600;
            color: #d4af37;
            font-size: 12px;
            margin-bottom: 2px;
        }

        .calendar-course-name {
            font-size: 10px;
            color: #e8f5f0;
            line-height: 1.2;
            margin-bottom: 2px;
        }

        .calendar-course-hours {
            font-size: 9px;
            color: #a0a6a4;
            margin-bottom: 2px;
        }

        .calendar-course-crn {
            font-size: 9px;
            color: #22c55e;
            font-weight: 500;
        }

        .calendar-summary {
            padding: 20px 24px;
            border-top: 1px solid rgba(212, 175, 55, 0.2);
        }

        .calendar-summary h3 {
            color: #d4af37;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-grid .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: rgba(212, 175, 55, 0.1);
            border-radius: 6px;
        }

        .summary-grid .summary-label {
            color: #e8f5f0;
            font-size: 14px;
        }

        .summary-grid .summary-value {
            color: #d4af37;
            font-weight: 600;
            font-size: 16px;
        }

        .course-list-summary {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .course-summary-item {
            display: grid;
            grid-template-columns: 80px 1fr 120px 80px;
            gap: 10px;
            align-items: center;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            font-size: 12px;
        }

        .course-summary-item .course-code {
            color: #d4af37;
            font-weight: 600;
        }

        .course-summary-item .course-name {
            color: #e8f5f0;
        }

        .course-summary-item .course-schedule {
            color: #a0a6a4;
        }

        .course-summary-item .course-crn {
            color: #22c55e;
            font-weight: 500;
        }

        .calendar-actions {
            display: flex;
            gap: 12px;
            padding: 20px 24px;
            border-top: 1px solid rgba(212, 175, 55, 0.2);
        }

        .export-calendar-btn, .close-calendar-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-calendar-btn {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }

        .export-calendar-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(34, 197, 94, 0.3);
        }

        .close-calendar-btn {
            background: transparent;
            border: 1px solid #a0a6a4;
            color: #a0a6a4;
        }

        .close-calendar-btn:hover {
            background: rgba(160, 166, 164, 0.1);
        }

        .empty-courses {
            text-align: center;
            padding: 40px 20px;
            color: #a0a6a4;
        }

        /* Light mode styles */
        body.light-mode {
            background: linear-gradient(135deg, #fefdf8 0%, #f9f6e8 100%);
            color: #2c1810;
        }

        body.light-mode .plan-header,
        body.light-mode .available-courses-section,
        body.light-mode .term-builder-section {
            background: linear-gradient(135deg, #fefdf8, #f4f0e0);
            border: 2px solid #d4af37;
            box-shadow: 0 4px 20px rgba(212, 175, 55, 0.2);
        }

        body.light-mode .plan-title,
        body.light-mode .section-title {
            color: #2c1810;
        }

        body.light-mode .stat-value,
        body.light-mode .summary-value,
        body.light-mode .course-code,
        body.light-mode .selected-course-code {
            color: #b8860b;
            font-weight: 700;
        }

        body.light-mode .stat-label,
        body.light-mode .course-name,
        body.light-mode .summary-label,
        body.light-mode .selected-course-name,
        body.light-mode .course-category {
            color: #2c1810;
            font-weight: 500;
        }

        body.light-mode .course-card {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(212, 175, 55, 0.2);
            box-shadow: 0 2px 10px rgba(13, 40, 24, 0.05);
        }

        body.light-mode .course-card:hover {
            background: rgba(212, 175, 55, 0.1);
            border-color: rgba(212, 175, 55, 0.4);
            box-shadow: 0 4px 15px rgba(13, 40, 24, 0.1);
        }

        body.light-mode .term-summary {
            background: rgba(212, 175, 55, 0.15);
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        body.light-mode .selected-course-item {
            background: rgba(212, 175, 55, 0.2);
            border: 1px solid rgba(212, 175, 55, 0.4);
        }

        body.light-mode .schedule-builder {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        body.light-mode .schedule-cell.occupied {
            background: linear-gradient(135deg, #f5e6a3, #e8d68a);
            border: 2px solid #d4af37;
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
            border-radius: 12px;
            margin: 2px;
        }

        body.light-mode .schedule-cell {
            background: linear-gradient(135deg, #fefdf8, #f9f6e8);
            border: 1px solid #e8d68a;
            border-radius: 8px;
            margin: 2px;
        }

        body.light-mode .time-header,
        body.light-mode .day-header {
            background: linear-gradient(135deg, #f4e4bc, #e6d7a3);
            color: #2c1810;
            font-weight: 700;
            border: 1px solid #d4af37;
            border-radius: 8px;
            margin: 2px;
        }

        body.light-mode .time-cell {
            background: linear-gradient(135deg, #faf6e8, #f0e8c8);
            color: #2c1810;
            font-weight: 700;
            border: 1px solid #d4af37;
            border-radius: 6px;
            margin: 2px;
            padding: 4px 2px;
            font-size: 8px;
            line-height: 1;
        }

        body.light-mode .course-block .course-code {
            color: #b8860b;
            font-weight: 700;
            font-size: 11px;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        }

        body.light-mode .course-block .course-name {
            color: #2c1810;
            font-weight: 600;
            font-size: 9px;
        }

        body.light-mode .course-block .course-crn {
            color: #b8860b;
            font-weight: 700;
            font-size: 8px;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        }

        body.light-mode .calendar-modal .calendar-content {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(212, 175, 55, 0.3);
        }

        body.light-mode .calendar-day-cell.has-course {
            background: linear-gradient(135deg, #f5e6a3, #e8d68a);
            border: 2px solid #d4af37;
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
            border-radius: 12px;
            margin: 2px;
        }

        body.light-mode .calendar-day-cell {
            background: linear-gradient(135deg, #fefdf8, #f9f6e8);
            border: 1px solid #e8d68a;
            border-radius: 8px;
            margin: 2px;
        }

        body.light-mode .calendar-course-block .calendar-course-code {
            color: #b8860b;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        }

        body.light-mode .calendar-course-block .calendar-course-name {
            color: #2c1810;
            font-weight: 600;
        }

        body.light-mode .calendar-course-block .calendar-course-crn {
            color: #b8860b;
            font-weight: 700;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        }

        body.light-mode .action-btn {
            background: rgba(255, 255, 255, 0.9);
            color: #2d5a3d;
            border: 2px solid rgba(212, 175, 55, 0.4);
        }

        body.light-mode .action-btn:hover:not(:disabled) {
            background: rgba(212, 175, 55, 0.2);
            border-color: rgba(212, 175, 55, 0.6);
        }

        body.light-mode .action-btn.primary {
            background: linear-gradient(135deg, #b8860b, #daa520);
            color: white;
        }

        body.light-mode .action-btn.primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #a0750a, #b8860b);
        }

        body.light-mode .time-select,
        body.light-mode .day-select,
        body.light-mode .crn-input {
            background: rgba(255, 255, 255, 0.9);
            color: #2d5a3d;
            border: 1px solid rgba(212, 175, 55, 0.4);
        }

        body.light-mode .course-hours {
            background: rgba(212, 175, 55, 0.2);
            color: #2d5a3d;
        }

        body.light-mode .prerequisites {
            color: #5a7c5a;
        }

        body.light-mode .empty-state {
            color: #5a7c5a;
        }

        body.light-mode .selected-course-hours {
            color: #5a7c5a;
        }

        body.light-mode .schedule-options {
            background: rgba(212, 175, 55, 0.2);
            border: 1px solid rgba(212, 175, 55, 0.4);
        }

        body.light-mode .schedule-option {
            color: #2c1810;
            font-weight: 600;
        }

        body.light-mode .schedule-option:hover {
            background: rgba(212, 175, 55, 0.3);
        }

        /* Responsive design */
        @media (max-width: 1024px) {
            .plan-content {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .term-builder-section {
                position: static;
            }
        }

        @media (max-width: 768px) {
            .progress-stats {
                gap: 15px;
                grid-template-columns: repeat(2, 1fr);
                display: grid;
            }
            
            .stat-value {
                font-size: 18px;
            }
            
            .stat-item {
                text-align: center;
            }
        }
    </style>
</body>
</html>
